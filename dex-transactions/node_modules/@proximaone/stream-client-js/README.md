# StreamDB Client JS

## Installation

StreamDB Client requires [Node.js](https://nodejs.org/) v12+ to run.

Install @proximaone/streamdb-client-js package 
```sh
yarn add @proximaone/streamdb-client-js
```

Install the dependencies and devDependencies.

```sh
yarn install
```

## Client Usage 

Client for StreamDB uses generated gRPC stubs to provide fast access to data. 

#### Documentation 
Link to documentation can be found here.
[https://buf.build/proximaone/streamapis/docs/main/messages.v1alpha1](https://buf.build/proximaone/streamapis/docs/main/messages.v1alpha1)


### Sample 

```typescript 
import { StreamClient } from "@proximaone/stream-client-js";

const client = new StreamClient("streamdb.cluster.prod.proxima.one:443");

 // rxjs's Observable<T>
const ethBlockHeadersStream = client
    .streamMessages("eth-main-headers")
    .pipe(
        mergeMap((response) =>
            response.messagesList.map((x) => {
                return {
                    payload: decodeJson(x.payload),
                    id: x.id, // event id, can be used to resume streaming
                    undo: x.header?.undo == true,
                    timestamp: x.timestamp,
                };
            })
        )
    );

ethBlockHeadersStream.subscribe(x => console.log(x));

const firstEthBlockHeaders = client.getNextMessages("eth-main-headers");

function decodeJson(binary: Uint8Array | string): any {
    const buffer =
        typeof binary == "string"
            ? Buffer.from(binary, "base64")
            : Buffer.from(binary);
    return JSON.parse(buffer.toString("utf8"));
}
```


### Get message from offset with specific size 

```javascript
      let streamId = "multiplefi"
      let latest = ""
      let messageCount = 100
      let request = new ProximaServiceTypes.GetNextMessagesRequest()
        .setStreamId(streamId)
        .setLastMessageId(latest)
        .setCount(messageCount)
      
      streamClient.getNextMessages(request, (serviceError, responses) => {
          //your code here 
          console.log(responses)
      })
```
